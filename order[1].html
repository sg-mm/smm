<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>New Order ‚Ä¢ Social Growth</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system}
body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at 20% 20%,#00f2ff22,transparent 40%),
    radial-gradient(circle at 80% 80%,#00ff8822,transparent 40%),
    linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}

/* Glow */
body::before{
  content:"";
  position:fixed;
  width:500px;
  height:500px;
  background:radial-gradient(circle,#00f2ff55,transparent 60%);
  top:-150px;
  left:-150px;
  animation:glow 8s infinite alternate;
}
@keyframes glow{
  from{transform:translate(0,0)}
  to{transform:translate(200px,150px)}
}

/* Top */
.topbar{
  height:60px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  background:rgba(0,0,0,.4);
  backdrop-filter:blur(15px);
}
.brand{
  font-weight:900;
  font-size:18px;
  background:linear-gradient(90deg,#00eaff,#00ff88);
  -webkit-background-clip:text;
  color:transparent;
}
.back{cursor:pointer}

.container{padding:20px;animation:fade .7s ease}
@keyframes fade{from{opacity:0;transform:translateY(20px)}to{opacity:1}}

.card{
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(20px);
  border-radius:25px;
  padding:22px;
  margin-bottom:20px;
  box-shadow:0 25px 60px rgba(0,0,0,.5);
}

label{font-size:13px;opacity:.85}
select,input{
  width:100%;
  padding:14px;
  margin:8px 0 16px;
  border:none;
  border-radius:16px;
  background:rgba(255,255,255,.12);
  color:#fff;
}
select option{color:#000;background:#fff}

.priceBox{
  font-size:30px;
  font-weight:900;
  background:linear-gradient(135deg,#00eaff,#00ff88);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 20px rgba(0,255,200,.6);
  margin:10px 0 16px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:20px;
  font-weight:900;
  background:linear-gradient(135deg,#00eaff,#00ff88);
  color:#000;
  cursor:pointer;
  box-shadow:0 0 30px rgba(0,255,200,.7);
}

.msg{
  margin-top:12px;
  font-weight:700;
  text-align:center;
  padding:10px;
  border-radius:12px;
}

.infoCard{
  background:linear-gradient(135deg,#00eaff22,#00ff8822);
  border-radius:18px;
  padding:18px;
  font-size:14px;
  line-height:1.7;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">Social Growth</div>
  <div class="back" onclick="window.location='home.html'">‚¨Ö Home</div>
</div>

<div class="container">

<div class="card">
<h2>New Order üöÄ</h2>

<label>Category</label>
<select disabled>
<option>Instagram</option>
</select>

<label>Service</label>
<select id="service">
<option disabled selected>Loading...</option>
</select>

<label>Instagram Link</label>
<input id="link" placeholder="Paste Instagram link">

<label>Quantity</label>
<input id="qty" type="number" oninput="calcPrice()">

<div class="priceBox">
‚Çπ <span id="price">0</span>
</div>

<button id="submitBtn" onclick="submitOrder()">Submit Order</button>
<div class="msg" id="msg"></div>

</div>

<div class="infoCard" id="infoText">
Select a service to see pricing details.
</div>

</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycby0UHijonDZaPPVyGpjKsAsc9OUTJusetjoQMwygHmiwPd7otW7B1p0D_oIwmuh5rIbIw/exec";
const userID=localStorage.getItem("userID");
if(!userID){window.location="index.html";}

let rate=0,min=0,max=0,serviceName="";
let isSubmitting=false;   // üîí submission lock

/* ===== PREMIUM SUCCESS SOUND ===== */
function playPremiumSuccess(){
let ctx=new (window.AudioContext||window.webkitAudioContext)();
let now=ctx.currentTime;

let osc1=ctx.createOscillator();
let osc2=ctx.createOscillator();
let gain=ctx.createGain();

osc1.type="triangle";
osc2.type="sine";

osc1.frequency.setValueAtTime(600,now);
osc1.frequency.exponentialRampToValueAtTime(1200,now+0.25);

osc2.frequency.setValueAtTime(800,now);
osc2.frequency.exponentialRampToValueAtTime(1600,now+0.25);

gain.gain.setValueAtTime(0.25,now);
gain.gain.exponentialRampToValueAtTime(0.001,now+0.4);

osc1.connect(gain);
osc2.connect(gain);
gain.connect(ctx.destination);

osc1.start(now);
osc2.start(now);
osc1.stop(now+0.4);
osc2.stop(now+0.4);
}

/* Load services */
fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getServices"})
})
.then(r=>r.json())
.then(d=>{
let select=document.getElementById("service");
select.innerHTML="<option disabled selected>Select Service</option>";
d.services.forEach(s=>{
select.innerHTML+=`
<option value="${s.name}|${s.rate}|${s.min}|${s.max}">
${s.name} (‚Çπ${s.rate}/1000)
</option>`;
});
});

document.getElementById("service").addEventListener("change",function(){
let data=this.value.split("|");
serviceName=data[0];
rate=parseFloat(data[1]);
min=parseInt(data[2]);
max=parseInt(data[3]);
calcPrice();
});

function calcPrice(){
let q=parseInt(qty.value)||0;
if(q<min||q>max){price.innerText="0";return;}
price.innerText=((q/1000)*rate).toFixed(2);
}

/* ===== SUBMIT ORDER ===== */
function submitOrder(){

if(isSubmitting) return;  // üîí prevent double click

let btn=document.getElementById("submitBtn");
let q=parseInt(qty.value)||0;
let total=parseFloat(price.innerText);

if(!serviceName||!link.value||q<min||q>max) return;

isSubmitting=true;
btn.disabled=true;
btn.innerText="Processing...";

fetch(API_URL,{
method:"POST",
body:JSON.stringify({
action:"placeOrder",
userID:userID,
service:serviceName,
quantity:q,
price:total
})
})
.then(r=>r.json())
.then(d=>{
if(d.ok){

playPremiumSuccess();

btn.innerText="Submitted Successfully ‚úÖ";

showMsg("Order Placed Successfully ‚úÖ",true);

qty.value="";
price.innerText="0";

}else{
btn.disabled=false;
btn.innerText="Submit Order";
isSubmitting=false;
showMsg(d.msg,false);
}
})
.catch(()=>{
btn.disabled=false;
btn.innerText="Submit Order";
isSubmitting=false;
showMsg("Server Error ‚ùå",false);
});
}

function showMsg(text,success){
msg.innerHTML=text;
msg.style.background=success?"#00ff8833":"#ff444433";
msg.style.color=success?"#00ff88":"#ff4444";
}
</script>

</body>
</html>